---
title: "POLS0066 - Data Analysis"
author: "GNWL7"
date: "2024-01-02"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Affective Polarisation in the French multiparty system`

## Setup

The data comes from Sciences Po's [Dataverse](https://data.sciencespo.fr/dataverse/donneesrecherche). Data from Waves 1-4 has been imported as csv's, and stored in the /data folder. It has been aggregated and cleaned in  `data_cleaning.R`.

```{r include=FALSE}
library(tidyverse)
library(viridis)
library(lmtest)
library(multiwayvcov)
library(lme4)
library(sjPlot)
load("data/recoded_data.RData")
```

### Adding Party Age

The analysis might involve party age:
```{r}
party_age <- tribble(
  ~party, ~party_creation, ~party_age,
  "DLF", 2014, 2022-2014,
  "EELV", 2010, 2022-2010,
  "LFI", 2016, 2022-2016,
  "LO", 1968, 2022-1968,
  "LR", 2002, 2022-2002,
  "LREM", 2016, 2022-2016,
  "MoDem", 2007, 2022-2007,
  "NPA", 2009, 2022-2009,
  "PCF", 1920, 2022-1920,
  "PS", 1969, 2022-1969,
  "Reconquete", 2021, 2022-2021,
  "RN", 1972, 2022-1972,
)

df1 <- aggreg_waves_recoded |> 
  filter(PID %in% party_age$party) |> 
  left_join(party_age, by = c("PID" = "party"))
```

Now let's create a simple model regressing party identity strength on party age.
```{r}
# Regress PID strength on party age
m1 <- lm(data = df1, PID_strength ~ party_age)
summary(m1)
```
This simple model yields no statistical significance.

### Adding Party Vote Share

In- and out-group evaluations will be weighted using vote shares so that larger parties count more. We use data for the first round of the 2022 Presidential election, from the French Ministry of the Interior (Ministère de l'Intérieur). Although this proxy has limitations, it has been used in previous studies and constitutes an improvement from unweighted evaluations. 

In the calculations of in- and out-bloc sympathy, each party's evaluation will be weighted by the ratio of votes gained by that party as a part of the bloc's overall votes. See Reiljan & Ryan (2021, Appendix) for more details.

```{r}
party_vote_shares <- tribble(
  ~party, ~vote_share, ~bloc, ~relative_vote_share,
  "LFI", 22.0, "left_greens", round(22.0 / (22.0 + 4.6 + 1.8),2),
  "EELV", 4.6, "left_greens", round(4.6 / (22.0 + 4.6 + 1.8),2),
  "PS", 1.8, "left_greens", round(1.8 / (22.0 + 4.6 + 1.8), 2),
  "LREM", 27.9, "centre_right", round(27.9 / (27.9 + 4.8),2),
  "LR", 4.8, "centre_right", round(4.8 / (27.9 + 4.8),2),
  "Reconquete", 7.1, "far_right", round(7.1 / (7.1 + 23.2),2),
  "RN", 23.2, "far_right", round(23.2 / (7.1 + 23.2), 2)
)
```




## Insight on the French Party System 

We can run some exploratory data analysis to explore how supporters of the most prominent French parties feel about each other.
```{r}
selected_parties <- c(
  "LFI", "EELV", "PS", "LREM", "LR", "RN", "Reconquete"
)

df_heatmap <- aggreg_waves_recoded |> 
  filter(!is.na(PID)) |> 
  select(
    id, group_sentiment_LFI, group_sentiment_EELV, group_sentiment_PS,
    group_sentiment_LREM, group_sentiment_LR, group_sentiment_RN,
    group_sentiment_Reconquete, PID
    ) |> 
  pivot_longer(cols = starts_with("group_sentiment"), names_to = "Group", values_to = "Sentiment") |> 
  group_by(PID, Group) |> 
  summarize(AvgSentiment = round(mean(Sentiment, na.rm = TRUE), 1)) |> 
  filter(PID %in% selected_parties) |> 
   # relevel from most right to most left (average ranking)
  mutate(
    PID = factor(PID, levels = c("RN", "Reconquete", "LR", "LREM", "PS", "EELV", "LFI")),
    Group = factor(
      fct_recode(Group, LFI = "group_sentiment_LFI", EELV = "group_sentiment_EELV",
                       PS = 'group_sentiment_PS', LREM = "group_sentiment_LREM",
                       LR = "group_sentiment_LR", Reconquete = "group_sentiment_Reconquete", 
                       RN = "group_sentiment_RN"),
      levels = c("RN", "Reconquete", "LR", "LREM", "PS", "EELV", "LFI")
    )
  )

heatmap_plot <- 
  ggplot(df_heatmap, aes(x = Group, y = PID, fill = AvgSentiment, label = AvgSentiment)) +
  geom_tile() +
  geom_text(color = "black", size = 3) +
  scale_fill_viridis_c(option = "plasma", alpha = 0.6) +
  scale_x_discrete(position = "top", limits = rev) +
  theme_minimal() +
  labs(title = "Figure 1. Partisan Like-Dislike Matrix",
       x = "Average sympathy for supporters of",
       y = "Party supported") +
  theme(panel.grid = element_blank(),
        legend.position = "none",
        text = element_text(family = "Times New Roman"),
        axis.title.y = element_text(angle = 0, vjust = 0.933),
        axis.title.x.top = element_text(margin = margin(t = 10, b = 10)),
        plot.title = element_text(face = "bold"))

heatmap_plot
```

This heatmap supports the idea of a tripolar French party system. Supporters of LFI, EELV, and PS all show an average degree of sympathy higher than 5 amongst the triad and lower than 5 for supporters of other parties. This corresponds to the left-greens bloc. The same can be observed for the LREM / LR and RN / Reconquete dyads, which respectively form the center-right and far-right bloc.

Let us confirm if these dynamics are similar when looking at party sympathy instead of supporters sympathy.
```{r}
selected_parties <- c(
  "LFI", "EELV", "PS", "LREM", "LR", "RN", "Reconquete"
)

df_heatmap2 <- aggreg_waves_recoded |> 
  filter(!is.na(PID)) |> 
  select(
    id, party_sympathy_LFI, party_sympathy_EELV, party_sympathy_PS,
    party_sympathy_LREM, party_sympathy_LR, party_sympathy_RN,
    party_sympathy_Reconquete, PID
    ) |> 
  pivot_longer(cols = starts_with("party_sympathy"), names_to = "Party", values_to = "Sympathy") |> 
  group_by(PID, Party) |> 
  summarize(AvgSympathy = round(mean(Sympathy, na.rm = TRUE), 1)) |> 
  filter(PID %in% selected_parties) |> 
   # relevel from most right to most left (average ranking)
  mutate(
    PID = factor(PID, levels = c("RN", "Reconquete", "LR", "LREM", "PS", "EELV", "LFI")),
    Party = factor(
      fct_recode(Party, LFI = "party_sympathy_LFI", EELV = "party_sympathy_EELV",
                       PS = 'party_sympathy_PS', LREM = "party_sympathy_LREM",
                       LR = "party_sympathy_LR", Reconquete = "party_sympathy_Reconquete", 
                       RN = "party_sympathy_RN"),
      levels = c("RN", "Reconquete", "LR", "LREM", "PS", "EELV", "LFI")
    )
  )

heatmap_plot2 <- 
  ggplot(df_heatmap2, aes(x = Party, y = PID, fill = AvgSympathy, label = AvgSympathy)) +
  geom_tile() +
  geom_text(color = "black", size = 3) +
  scale_fill_viridis_c(option = "plasma", alpha = 0.6) +
  scale_x_discrete(position = "top", limits = rev) +
  theme_minimal() +
  labs(title = "Figure 2. Party Sympathy Matrix",
       x = "Average sympathy for",
       y = "Party supported") +
  theme(panel.grid = element_blank(),
        legend.position = "none",
        text = element_text(family = "Times New Roman"),
        axis.title.y = element_text(angle = 0, vjust = 0.933),
        axis.title.x.top = element_text(margin = margin(t = 10, b = 10)),
        plot.title = element_text(face = "bold"))

heatmap_plot2
```
Similar results are displayed in Figure 2, with the main difference being that grades are slightly lower for out-parties than their supporters in general, and higher for in-parties than in-supporters.

Exploratory analysis of data from the 2022 French Election Study therefore corroborates Knapp's analysis (2022). The tripolarisation of the party system in France follows a logical ideological pattern.

## Wave 4 Analysis - The Impact of Ideological Difference and Partisan Identity on Affective Polarisation

We can now move on to the testing of our hypotheses. 

The fourth wave of the 2022 French Election Study, carried out after the Presidential election from April 28 to June 2, 2022, takes up the entirety of module 6 (2021-2026) of the CSES (Comparative study of electoral systems) international comparison project.

```{r}
# Subset participants who:
#   participated in wave 4
#   have expressed an in-party sympathy
#   have revealed their position on the left-right scale
# N = 1034
df_W4 <- aggreg_waves_recoded |> 
  filter(W4 & in_party_sympathy & left_right_self)
```

### Adding Ideological distance

To include ideological distance in models, both the objective and subjective ideological positions of parties can be computed. Objective ideological position is the respondents' average rating of the party's left-right position. Subjective ideological position is each respondent's rating of the party's left-right position.

```{r}
df_ideological <- df_W4 |>
  mutate(
    subj_ideo_dist_LFI = abs(left_right_LFI - left_right_self),
    subj_ideo_dist_EELV = abs(left_right_EELV - left_right_self),
    subj_ideo_dist_PS = abs(left_right_PS - left_right_self),
    subj_ideo_dist_MoDem = abs(left_right_MoDem - left_right_self),
    subj_ideo_dist_LREM = abs(left_right_LREM - left_right_self),
    subj_ideo_dist_LR = abs(left_right_LR - left_right_self),
    subj_ideo_dist_RN = abs(left_right_RN - left_right_self),
    subj_ideo_dist_Reconquete = abs(left_right_Reconquete - left_right_self)
  )|> 
  mutate(
    obj_ideo_dist_LFI = abs(mean(left_right_LFI, na.rm = TRUE) - left_right_self),
    obj_ideo_dist_EELV = abs(mean(left_right_EELV, na.rm = TRUE) - left_right_self),
    obj_ideo_dist_PS = abs(mean(left_right_PS, na.rm = TRUE) - left_right_self),
    obj_ideo_dist_MoDem = abs(mean(left_right_MoDem, na.rm = TRUE) - left_right_self),
    obj_ideo_dist_LREM = abs(mean(left_right_LREM, na.rm = TRUE) - left_right_self),
    obj_ideo_dist_LR = abs(mean(left_right_LR, na.rm = TRUE) - left_right_self),
    obj_ideo_dist_RN = abs(mean(left_right_RN, na.rm = TRUE) - left_right_self),
    obj_ideo_dist_Reconquete = abs(mean(left_right_Reconquete, na.rm = TRUE) - left_right_self)
  ) |> 
  mutate(
    ideo_extreme = abs(left_right_self - 5)
  ) |> 
  select(-left_right_LFI, -left_right_EELV, -left_right_PS, -left_right_LREM,
         -left_right_LR, -left_right_RN, -left_right_Reconquete, -left_right_MoDem)

```

Starting with subjective ideological distance: 

```{r}
# Long dataset with, for each respondent, their subjective ideological distance
# and party symapthy for all parties
df_party_dislike_subj_long <- 
  df_ideological |> 
  select(
    id, age_decade, diploma, sex,
    party_sympathy_LFI, party_sympathy_EELV, party_sympathy_PS,
    party_sympathy_LREM, party_sympathy_LR, party_sympathy_RN,
    party_sympathy_Reconquete, party_sympathy_MoDem,
    interest_politics, PID, PID_strength, ideo_extreme, 
    subj_ideo_dist_LFI, subj_ideo_dist_EELV, subj_ideo_dist_PS,
    subj_ideo_dist_MoDem, subj_ideo_dist_LREM, subj_ideo_dist_LR,
    subj_ideo_dist_RN, subj_ideo_dist_Reconquete) |> 
  pivot_longer(
    cols = starts_with("party_sympathy_"),
    names_to = "party",
    values_to = "party_sympathy"
  ) |> 
  pivot_longer(
    cols = starts_with("subj_ideo_dist_"),
    names_to = "subj_ideo_dist",
    values_to = "subj_ideo_distance"
  ) |> 
  mutate(party = gsub("party_sympathy_", "", party)) |> 
  filter(party == gsub("subj_ideo_dist_", "", subj_ideo_dist)) |> 
  filter(PID != party)
```

Party sympathy for out-parties can be regressed on subjective ideological distance. We use multilevel linear regression models because the data structure is nested within the respondent, with 7 dyads between the respondent and the out-party.

```{r}
# Model 1: Subjective Ideological Distance, Political Interest, and Demographic controls
# Multilevel linear regression model with random intercepts
model1_party_dislike_subj <- lmer(
  data = df_party_dislike_subj_long,
  party_sympathy ~ 
    subj_ideo_distance + ideo_extreme + interest_politics + age_decade + diploma + sex + (1 | id)
)

tab_model(model1_party_dislike_subj)


# Model 2: Adding partisan identity strength
model2_party_dislike_subj <- lmer(
  data = df_party_dislike_subj_long,
  party_sympathy ~ 
    subj_ideo_distance + PID_strength + ideo_extreme + interest_politics + age_decade + diploma + sex + (1 | id)
)

tab_model(model2_party_dislike_subj)


# Model 3: Interaction between subjective ideological difference and political identity strength 
model3_party_dislike_subj <- lmer(
  data = df_party_dislike_subj_long,
  party_sympathy ~ 
    subj_ideo_distance*PID_strength + ideo_extreme + interest_politics + age_decade + diploma + sex + (1 | id)
) 

tab_model(model3_party_dislike_subj)

# Model 4: Interaction between subjective ideological difference and ideological extremity
model4_party_dislike_subj <- lmer(
  data = df_party_dislike_subj_long,
  party_sympathy ~ 
    subj_ideo_distance*ideo_extreme + PID_strength + interest_politics + age_decade + diploma + sex + (1 | id)
) 

tab_model(model4_party_dislike_subj)
```

Of course, using the subjective measure of ideological distance does not fully exclude the possibility that the relationship may partly work reversed as well, and that a more negative affect towards a group may also cause people to perceive these groups as more ideologically distant. For this reason, we also run the same model with the objective ideological distance measure instead" (Erkel & Turkenburg, 2023, p. 396)

```{r}
# Long dataset with, for each respondent, their subjective ideological distance
# and party symapthy for all parties
df_party_dislike_obj_long <- 
  df_ideological |> 
  select(
    id, age_decade, diploma, sex,
    party_sympathy_LFI, party_sympathy_EELV, party_sympathy_PS,
    party_sympathy_LREM, party_sympathy_LR, party_sympathy_RN,
    party_sympathy_Reconquete, party_sympathy_MoDem,
    interest_politics, PID, PID_strength, ideo_extreme, 
    obj_ideo_dist_LFI, obj_ideo_dist_EELV, obj_ideo_dist_PS,
    obj_ideo_dist_MoDem, obj_ideo_dist_LREM, obj_ideo_dist_LR,
    obj_ideo_dist_RN, obj_ideo_dist_Reconquete) |> 
  pivot_longer(
    cols = starts_with("party_sympathy_"),
    names_to = "party",
    values_to = "party_sympathy"
  ) |> 
  pivot_longer(
    cols = starts_with("obj_ideo_dist_"),
    names_to = "obj_ideo_dist",
    values_to = "obj_ideo_distance"
  ) |> 
  mutate(party = gsub("party_sympathy_", "", party)) |> 
  filter(party == gsub("obj_ideo_dist_", "", obj_ideo_dist)) |> 
  filter(PID != party)
```

On with the multilevel linear regression models:

```{r}
# Model 1: Objective Ideological Distance, Political Interest, and Demographic controls
# Multilevel linear regression model with random intercepts
model1_party_dislike_obj <- lmer(
  data = df_party_dislike_obj_long,
  party_sympathy ~ 
    obj_ideo_distance + ideo_extreme + interest_politics + age_decade + diploma + sex + (1 | id)
)

tab_model(model1_party_dislike_obj)


# Model 2: Adding partisan identity strength
model2_party_dislike_obj <- lmer(
  data = df_party_dislike_obj_long,
  party_sympathy ~ 
    obj_ideo_distance + PID_strength + ideo_extreme + interest_politics + age_decade + diploma + sex + (1 | id)
)

tab_model(model2_party_dislike_obj)


# Model 3: Interaction between objective ideological difference and political identity strength 
model3_party_dislike_obj <- lmer(
  data = df_party_dislike_obj_long,
  party_sympathy ~ 
    obj_ideo_distance*PID_strength + ideo_extreme + interest_politics + age_decade + diploma + sex + (1 | id)
) 

tab_model(model3_party_dislike_obj)

# Model 4: Interaction between objective ideological difference and ideological extremity
model4_party_dislike_obj <- lmer(
  data = df_party_dislike_obj_long,
  party_sympathy ~ 
    obj_ideo_distance*ideo_extreme + PID_strength + interest_politics + age_decade + diploma + sex + (1 | id)
) 

tab_model(model4_party_dislike_obj)
```
## Waves 2, 3 & 4 Analysis - The Ideological Drivers of Affective polarisation Within the Three Blocs

First supporters within the Left-plus-Greens bloc:

```{r}
left_greens <- c("LFI", "EELV", "PS")
centre_right <- c("LREM", "RN")
far_right <- c("RN", "Reconquete")

# ---- Left-plus-Greens bloc ---- 
left_bloc_df <- aggreg_waves_recoded |> 
  filter(!is.na(in_party_sympathy) 
         & PID %in% left_greens) |> 
  
  # out-group and in-group sympathy, weighted by vote share
  mutate(
    out_group_sympathy_centre_right = 
      1/2 * group_sentiment_LREM * party_vote_shares$relative_vote_share[party_vote_shares$party == "LREM" ] +
      1/2 * group_sentiment_LR * party_vote_shares$relative_vote_share[party_vote_shares$party == "LR" ] ,
    out_group_sympathy_far_right = 
      1/2 * group_sentiment_Reconquete * party_vote_shares$relative_vote_share[party_vote_shares$party == "Reconquete" ] +
      1/2 * group_sentiment_RN * party_vote_shares$relative_vote_share[party_vote_shares$party == "RN" ] ,
    in_group_sympathy = 
      1/3 * group_sentiment_LFI * party_vote_shares$relative_vote_share[party_vote_shares$party == "LFI" ] +
      1/3 * group_sentiment_EELV * party_vote_shares$relative_vote_share[party_vote_shares$party == "EELV" ] +
      1/3 * group_sentiment_PS * party_vote_shares$relative_vote_share[party_vote_shares$party == "PS" ]
    ) |> 
  
  # affective polarisation
  mutate(affect_polarisation_centre_right = in_party_sympathy - out_group_sympathy_centre_right,
         affect_polarisation_far_right = in_party_sympathy - out_group_sympathy_far_right)

# ---- Models ----
# Polarisation with centre-right
model_left_and_centre_right <- lm(
  data = left_bloc_df, affect_polarisation_centre_right ~ 
    PID_strength + socioeco + in_group_sympathy + environment +
    + immigration + interest_politics
  )
summary(model_left_and_centre_right)

# Polarisation with far-right
model_left_and_far_right <- lm(
  data = left_bloc_df, affect_polarisation_far_right ~ 
    PID_strength + socioeco + in_group_sympathy + environment +
    + immigration + interest_politics
  )
summary(model_left_and_far_right)

```

Next, respondents within the centre-right group. Importantly, there are less respondents within this bloc: N = 149.

```{r}
# ---- Centre-right bloc ---- 
far_right_bloc_df <- aggreg_waves_recoded |> 
  filter(!is.na(in_party_sympathy) 
         & PID %in% far_right) |> 
  
  # out-group and in-group sympathy, weighted by vote share
  mutate(
    out_group_sympathy_left = 
      1/3 * group_sentiment_LFI * party_vote_shares$relative_vote_share[party_vote_shares$party == "LFI" ] +
      1/3 * group_sentiment_EELV * party_vote_shares$relative_vote_share[party_vote_shares$party == "EELV" ] +
      1/3 * group_sentiment_PS * party_vote_shares$relative_vote_share[party_vote_shares$party == "PS" ],
    out_group_sympathy_center_right = 
      1/2 * group_sentiment_LREM * party_vote_shares$relative_vote_share[party_vote_shares$party == "LREM" ] +
      1/2 * group_sentiment_LR * party_vote_shares$relative_vote_share[party_vote_shares$party == "LR" ] ,
    in_group_sympathy = 
      1/2 * group_sentiment_Reconquete * party_vote_shares$relative_vote_share[party_vote_shares$party == "Reconquete" ] +
      1/2 * group_sentiment_RN * party_vote_shares$relative_vote_share[party_vote_shares$party == "RN" ]
    ) |> 
  
  # affective polarisation
  mutate(affect_polarisation_left = in_party_sympathy - out_group_sympathy_left,
         affect_polarisation_center_right = in_party_sympathy - out_group_sympathy_center_right)

# ---- Models ----
# Polarisation with left-plus-greens
model_left_and_far_right <- lm(
  data = far_right_bloc_df, affect_polarisation_left ~ 
    PID_strength + socioeco + in_group_sympathy + environment +
    + immigration + interest_politics
  )
summary(model_left_and_far_right)

# Polarisation with far-right
model_far_and_center_right <- lm(
  data = far_right_bloc_df, affect_polarisation_center_right ~ 
    PID_strength + socioeco + in_group_sympathy + environment +
    + immigration + interest_politics
  )
summary(model_far_and_center_right)
```

Finally, let's observe the determinents of affective polarisation for supporters of parties within the far-right bloc:

```{r}
# ---- Far-Right group ---- 
centre_right_bloc_df <- aggreg_waves_recoded |> 
  filter(!is.na(in_party_sympathy) 
         & PID %in% centre_right) |> 
  
  # out-group and in-group sympathy, weighted by vote share
  mutate(
    out_group_sympathy_left = 
      1/3 * group_sentiment_LFI * party_vote_shares$relative_vote_share[party_vote_shares$party == "LFI" ] +
      1/3 * group_sentiment_EELV * party_vote_shares$relative_vote_share[party_vote_shares$party == "EELV" ] +
      1/3 * group_sentiment_PS * party_vote_shares$relative_vote_share[party_vote_shares$party == "PS" ],
    out_group_sympathy_far_right = 
      1/2 * group_sentiment_Reconquete * party_vote_shares$relative_vote_share[party_vote_shares$party == "Reconquete" ] +
      1/2 * group_sentiment_RN * party_vote_shares$relative_vote_share[party_vote_shares$party == "RN" ] ,
    in_group_sympathy = 
      1/2 * group_sentiment_LREM * party_vote_shares$relative_vote_share[party_vote_shares$party == "LREM" ] +
      1/2 * group_sentiment_LR * party_vote_shares$relative_vote_share[party_vote_shares$party == "LR" ]
    ) |> 
  
  # affective polarisation
  mutate(affect_polarisation_left = in_party_sympathy - out_group_sympathy_left,
         affect_polarisation_far_right = in_party_sympathy - out_group_sympathy_far_right)

# ---- Models ----
# Polarisation with left-plus-greens
model_centre_right_and_left <- lm(
  data = centre_right_bloc_df, affect_polarisation_left ~ 
    PID_strength + socioeco + in_group_sympathy + environment +
    + immigration + interest_politics
  )
summary(model_centre_right_and_left)

# Polarisation with centre-right
model_centre_and_far_right <- lm(
  data = centre_right_bloc_df, affect_polarisation_far_right ~ 
    PID_strength + socioeco + in_group_sympathy + environment +
    + immigration + interest_politics
  )
summary(model_centre_and_far_right)
```